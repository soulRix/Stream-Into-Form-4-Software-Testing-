{% extends "baseAdmin.html" %}
{% block admin %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.min.css" integrity="sha512-yVvxUQV0QESBt1SyZbNJMAwyKvFTLMyXSyBHDO4BG5t7k/Lw34tyqlSDlKIrIENIzCl+RVUNjmCPG+V/GMesRw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        .chosen-choices 
        {
            padding: 0.375rem 0.75rem !important;
            border-radius: 0.25rem !important;
            border: 1px solid #ced4da !important;
        }

    </style>


    <div class = "container">
        <div class = "row justify-content-center">
            <div class = "text-center mb-5">
                <h2>Add A School</h2>
                <hr>
                <h4> Fill the neccessary field to add a School</h4>
            </div>
            
        </div>
        <!-- Form Here -->
        <form method = "POST" class = "needs-validation" action = "" enctype = "multipart/form-data">
            <!-- Protect from Forgery Attacks so need the hidden Tag -->
            {{ form.hidden_tag() }}

            <!-- School Name -->
            <div class = "row justify-content-center mb-4">
                <div class = "col-sm-2 col-form-label">
                    {{ form.schoolName.label(class="form-label fw-bold") }}
                </div>

                <div class = "col-sm-7">
                    <!-- Invalid Message Error -->
                    {% if form.schoolName.errors %}
                        {{ form.schoolName(class="form-control is-invalid") }}
                        <div class = "invalid-feedback">
                            {% for error in form.schoolName.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- Valid -->
                        {{ form.schoolName(class="form-control") }}
                    {% endif %}
                </div>
            </div>

            <!-- School Short Name -->
            <div class = "row justify-content-center mb-4">
                <div class = "col-sm-2 col-form-label">
                    {{ form.shortSchoolName.label(class="form-label fw-bold") }}
                </div>

                <div class = "col-sm-7">
                    <!-- Invalid Message Error -->
                    {% if form.shortSchoolName.errors %}
                        {{ form.shortSchoolName(class="form-control is-invalid") }}
                        <div class = "invalid-feedback">
                            {% for error in form.shortSchoolName.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- Valid -->
                        {{ form.shortSchoolName(class="form-control") }}
                    {% endif %}
                </div>
            </div>

            <!-- School Address -->
            <div class = "row justify-content-center mb-4">
                <div class = "col-sm-2 col-form-label">
                    {{ form.schoolAddress.label(class="form-label fw-bold") }}
                </div>

                <div class = "col-sm-7">
                    <!-- Invalid Message Error -->
                    {% if form.schoolAddress.errors %}
                        {{ form.schoolAddress(class="form-control is-invalid") }}
                        <div class = "invalid-feedback">
                            {% for error in form.schoolAddress.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- Valid -->
                        {{ form.schoolAddress(class="form-control") }}
                    {% endif %}
                </div>
            </div>

            <!-- School Code -->
            <div class = "row justify-content-center mb-4">
                <div class = "col-sm-2 col-form-label">
                    {{ form.schoolCode.label(class="form-label fw-bold") }}
                </div>

                <div class = "col-sm-7">
                    <!-- Invalid Message Error -->
                    {% if form.schoolCode.errors %}
                        {{ form.schoolCode(class="form-control is-invalid") }}
                        <div class = "invalid-feedback">
                            {% for error in form.schoolCode.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- Valid -->
                        {{ form.schoolCode(class="form-control") }}
                    {% endif %}
                </div>
            </div>

            <!-- School Type -->
            <div class = "row justify-content-center mb-4">
                <div class = "col-sm-2 col-form-label">
                    {{ form.shortForm.label(class="form-label fw-bold") }}
                </div>

                <div class = "col-sm-7">
                    <!-- Invalid Message Error -->
                    {% if form.shortForm.errors %}
                        {{ form.shortForm(class="form-select is-invalid") }}
                        <div class = "invalid-feedback">
                            {% for error in form.shortForm.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- Valid -->
                        {{ form.shortForm(class="form-select") }}
                    {% endif %}
                </div>
            </div>

            <div class = "row justify-content-center mb-2">
                <div class = "col-sm-2">
                </div>
                <div class = "col-sm-7">
                    <h6 class = "text-danger text-center"> - Please Select the State First -</h6>
                </div>
            </div>

            <!-- School State -->
            <div class = "row justify-content-center mb-4">
                <div class = "col-sm-2 col-form-label fw-bold">
                    School State
                </div>

                <div class = "col-sm-7">
                    <!-- Invalid Message Error -->
                    {% if form.schoolState.errors %}
                        {{ form.schoolState(class="form-select is-invalid") }}
                        <div class = "invalid-feedback">
                            {% for error in form.schoolState.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- Valid -->
                        {{ form.schoolState(class="form-select") }}

                    {% endif %}
                </div>
            </div>

            <!-- School Zone -->
            <div class = "row justify-content-center mb-4">
                <div class = "col-sm-2 col-form-label">
                    {{ form.schoolZon.label(class="form-label fw-bold") }}
                </div>

                <div class = "col-sm-7">
                    <!-- Invalid Message Error -->
                    {% if form.schoolZon.errors %}
                        {{ form.schoolZon(class="form-select is-invalid") }}
                        <div class = "invalid-feedback">
                            {% for error in form.schoolZon.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- Valid -->
                        {{ form.schoolZon(class="form-select") }}
                    {% endif %}
                </div>
            </div>

            <!-- School Logo -->
            <div class="row justify-content-center mb-3">
                <div class = "col-sm-2 col-form-label">
                    {{ form.schoolLogo.label(class="form-label fw-bold") }}
                </div>
                <div class = "col-sm-7">
                    {{ form.schoolLogo(class="form-control" , type = "file") }}
                    {% if form.schoolLogo.errors %}
                        {% for error in form.schoolLogo.errors %}
                        <span class = "text-danger">{{ error }}</span><br>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>

            <!-- School Email -->
            <div class = "row justify-content-center mb-4">
                <div class = "col-sm-2 col-form-label">
                    {{ form.schoolEmail.label(class="form-label fw-bold") }}
                </div>

                <div class = "col-sm-7">
                    <!-- Invalid Message Error -->
                    {% if form.schoolEmail.errors %}
                        {{ form.schoolEmail(class="form-control is-invalid") }}
                        <div class = "invalid-feedback">
                            {% for error in form.schoolCode.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- Valid -->
                        {{ form.schoolEmail(class="form-control") }}
                    {% endif %}
                </div>
            </div>

            <!-- School Phone Number -->
            <div class = "row justify-content-center mb-4">
                <div class = "col-sm-2 col-form-label">
                    {{ form.schoolPhoneNumber.label(class="form-label fw-bold") }}
                </div>

                <div class = "col-sm-7">
                    <!-- Invalid Message Error -->
                    {% if form.schoolPhoneNumber.errors %}
                        {{ form.schoolPhoneNumber(class="form-control is-invalid") }}
                        <div class = "invalid-feedback">
                            {% for error in form.schoolPhoneNumber.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- Valid -->
                        {{ form.schoolPhoneNumber(class="form-control") }}
                    {% endif %}
                </div>
            </div>

            <!-- School Moto -->
            <div class = "row justify-content-center mb-4">
                <div class = "col-sm-2 col-form-label">
                    {{ form.schoolMoto.label(class="form-label fw-bold") }}
                </div>

                <div class = "col-sm-7">
                    <!-- Invalid Message Error -->
                    {% if form.schoolMoto.errors %}
                        {{ form.schoolMoto(class="form-control is-invalid") }}
                        <div class = "invalid-feedback">
                            {% for error in form.schoolCode.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- Valid -->
                        {{ form.schoolMoto(class="form-control") }}
                    {% endif %}
                </div>
            </div>

            <!-- School Vision -->
            <div class = "row justify-content-center mb-4">
                <div class = "col-sm-2 col-form-label">
                    {{ form.schoolVision.label(class="form-label fw-bold") }}
                </div>

                <div class = "col-sm-7">
                    <!-- Invalid Message Error -->
                    {% if form.schoolVision.errors %}
                        {{ form.schoolVision(class="form-control is-invalid") }}
                        <div class = "invalid-feedback">
                            {% for error in form.schoolVision.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- Valid -->
                        {{ form.schoolVision(class="form-control") }}
                    {% endif %}
                </div>
            </div>

            <!-- School Description -->
            <div class = "row justify-content-center mb-4">
                <div class = "col-sm-2 col-form-label">
                    {{ form.schoolDescription.label(class="form-label fw-bold") }}
                </div>

                <div class = "col-sm-7">
                    <!-- Invalid Message Error -->
                    {% if form.schoolDescription.errors %}
                        {{ form.schoolDescription(class="form-control is-invalid") }}
                        <div class = "invalid-feedback">
                            {% for error in form.schoolDescription.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        <!-- Valid -->
                        {{ form.schoolDescription(class="form-control") }}
                    {% endif %}
                </div>
            </div>


            

            <!-- Stream Package List -->
            <div class = "row justify-content-center mb-2">
                <div class = "col">
                    <h3 class = "text-dark text-center"> - Stream Package -</h3>
                    <hr>
                    <h6 class = "text-secondary text-center"> Please Enter The Stream Package Name and it's Subjects ( Max of 10 Stream Package and Up to 20 Subject per Stream )</h6>
                    <br>
                </div>
            </div>
            <div class = "row justify-content-center mb-2">
                <div class = "col-sm-10">
                    <div class = "input-field">
                        <table class="table table-bordered text-center" id = "table_field">
                            <thead>
                            <tr>
                                <th scope="col">Stream Package Name</th>
                                <th scope="col">Subject</th>
                                <th scope="col">Add or Remove</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td><input class = "form-control " type = "text" name = "streamName[]" value = ""/></td>
                                <td>
                                    <select data-placeholder="Subject Options..." id = "subjectSelect" class = "chosen-select chosen-choices" name = "checkboxSubject" multiple tabindex="4">
                                        {% for value in subject %}
                                            <option value="{{value.subject_title}}">{{ value.subject_title }}</option>
                                        {% endfor %}
                                    </select>
                                </td>
                                <td>
                                    <a class = "btn btn-outline-success" type = "button" name = "add" id = "add" value = "Add">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-file-plus-fill" viewBox="0 0 16 16">
                                            <path d="M12 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM8.5 6v1.5H10a.5.5 0 0 1 0 1H8.5V10a.5.5 0 0 1-1 0V8.5H6a.5.5 0 0 1 0-1h1.5V6a.5.5 0 0 1 1 0z"/>
                                          </svg>
                                    </a>
                                    
                                    
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
                        
            <div class = "text-center">
                {{ form.submit(class = "btn btn-primary mt-3")}}
            </div>
        </form>
    </div>




    <script type="text/javascript">
        function fieldHTML(inputNumber) {
                return `<tr>\
                            <td><input class = "form-control " type = "text" name = "streamName[]" value = ""/></td>\
                            <td>\
                                <select data-placeholder="Subject Options..." id = "subjectSelect" class = "chosen-select chosen-choices" name = "checkboxSubject${inputNumber}" multiple tabindex="4">\
                                    {% for value in subject %}\
                                        <option value="{{value.subject_title}}">{{ value.subject_title }}</option>\
                                    {% endfor %}\
                                </select>\
                            </td>\
                            <td>\
                                <a class = "btn btn-outline-danger" type = "button" name = "remove" id = "remove" value = "Remove"> \
                                    <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" class="bi bi-file-x-fill" viewBox="0 0 16 16">\
                                        <path d="M12 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zM6.854 6.146 8 7.293l1.146-1.147a.5.5 0 1 1 .708.708L8.707 8l1.147 1.146a.5.5 0 0 1-.708.708L8 8.707 6.854 9.854a.5.5 0 0 1-.708-.708L7.293 8 6.146 6.854a.5.5 0 1 1 .708-.708z"/>\
                                    </svg>\
                                </a>\
                            </td>\
                        </tr>`
            }
        var addButton = $("#add");
        var wrapper = $("#table_field");
        var maxField = 9
        var x = 1;
        $(addButton).on('click', function(e){
            if(x <= maxField)
            {
                $(".chosen-select").chosen('destroy');
                x++;
                $(wrapper).append(fieldHTML(x));
            }
            else{
                alert("Maximum fields is 10.");
            }
            $(".chosen-select").chosen({ width:"100%" , max_selected_options: 20});
        })
        $(wrapper).on('click','#remove',function(){
                $(this).closest('tr').remove()
                x--;
        });
            

    </script>
    <!-- Script -->
    <script type="text/javascript">
        $(document).ready(function () {
         $('.chosen-select').chosen({ width:"100%" , max_selected_options: 20});
         
         });
         
    </script>

    <script>
        state_select = document.getElementById('schoolState');
        zone_select = document.getElementById('schoolZon');

        state_select.onchange = function(){
            state = state_select.value;
            // alert(state);
        
            fetch('/zone/' + state).then(function(response){
                response.json().then(function(data){
                    //console.table(data)
                    let optionHTML = "";
                    for(let zone of data.zonelist){
                        optionHTML += '<option value="' + zone.id + '">' + zone.code + ' - ' + zone.name + '</option>';
                    }

                    zone_select.innerHTML = optionHTML;

                });
            });
        }
    </script>


{% endblock admin%}